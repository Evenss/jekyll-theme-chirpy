# Memoryä»‹ç»
## Agentæ¶æ„
![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/121056529/1762676410529-58151223-212e-4f18-8fa9-d3de6788c8f9.png)

ï¼ˆæ¥è‡ª The Rise and Potential of Large Language Model Based Agents: A Surveyï¼‰ï¼š

1. æ„ŸçŸ¥èƒ½åŠ›ï¼ˆPerceptionï¼‰ï¼šä¿¡æ¯è¾“å…¥ã€‚
2. å†³ç­–èƒ½åŠ›ï¼ˆBrain-Decision Makingï¼‰ï¼šè‡ªä¸»å†³ç­–å’Œè§„åˆ’ï¼Œæ‰§è¡Œæ›´å¤æ‚çš„ä»»åŠ¡ã€‚
3. è®°å¿†èƒ½åŠ›ï¼ˆBrain-Memory & Knowledgeï¼‰ï¼šå…·å¤‡è®°å¿†èƒ½åŠ›ï¼Œå­˜å‚¨ Agent çš„çŸ¥è¯†å’ŒæŠ€èƒ½ã€‚
4. è¡ŒåŠ¨èƒ½åŠ›ï¼ˆActionï¼‰ï¼šä¸å¤–ç•Œäº¤äº’ï¼Œé€šè¿‡è¡ŒåŠ¨ä¸æ„ŸçŸ¥è®© Agent èƒ½è‡ªä¸»å®Œæˆæ›´å¤šå¤æ‚ä»»åŠ¡ã€‚

## è®°å¿†å¯¹Agentçš„ä½œç”¨
1. <font style="color:rgb(37, 39, 42);">è®© Agent å…·å¤‡æŒç»­å­¦ä¹ èƒ½åŠ›</font>
    - <font style="color:rgb(37, 39, 42);">ä»è¿‡å»ç»å†ä¸­æ€»ç»“ç»éªŒä»¥åŠä»é”™è¯¯ä¸­å­¦ä¹ ï¼ŒåŠ å¼ºä»»åŠ¡è¡¨ç°ã€‚</font>
2. <font style="color:rgb(37, 39, 42);">è®© Agent èƒ½å¤Ÿä¿æŒå¯¹è¯çš„è¿è´¯æ€§å’Œè¡ŒåŠ¨çš„ä¸€è‡´æ€§ï¼š</font>
    - <font style="color:rgb(37, 39, 42);">å…·å¤‡æ›´è¿œè·ç¦»çš„ä¸Šä¸‹æ–‡ç®¡ç†èƒ½åŠ›ï¼Œåœ¨é•¿å¯¹è¯ä¸­èƒ½å¤Ÿä¿æŒä¸€è‡´çš„ä¸Šä¸‹æ–‡ä»è€Œä¿æŒè¿è´¯æ€§ã€‚</font>
    - <font style="color:rgb(37, 39, 42);">é¿å…å»ºç«‹ä¸ä¹‹å‰ç›¸çŸ›ç›¾çš„äº‹å®ï¼Œä¿æŒè¡ŒåŠ¨çš„ä¸€è‡´æ€§ã€‚</font>
3. <font style="color:rgb(37, 39, 42);">è®© Agent èƒ½å¤Ÿæä¾›ä¸ªæ€§åŒ–çš„æœåŠ¡å’Œç”¨æˆ·ä½“éªŒ</font>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/121056529/1762676911596-f89ff7b9-3e1a-4413-a473-c6dd62122a8c.png)

# Memory VS RAG
+ **<font style="color:rgb(17, 17, 51);">AI è®°å¿†</font>**<font style="color:rgb(17, 17, 51);">æ›´åƒæ˜¯æ¨¡å‹çš„â€œä¸ªäººç»éªŒâ€æˆ–â€œå¯¹è¯å†å²â€ï¼Œä¾§é‡äº</font>**<font style="color:rgb(17, 17, 51);">å†…éƒ¨çŠ¶æ€çš„æŒç»­æ€§å’Œä¸ªæ€§åŒ–</font>**<font style="color:rgb(17, 17, 51);">ã€‚</font>
+ **<font style="color:rgb(17, 17, 51);">RAG</font>**<font style="color:rgb(17, 17, 51);"> </font><font style="color:rgb(17, 17, 51);">åˆ™åƒæ˜¯ç»™æ¨¡å‹é…å¤‡äº†ä¸€ä¸ªâ€œå®æ—¶å‚è€ƒå›¾ä¹¦é¦†â€ï¼Œä¾§é‡äº</font>**<font style="color:rgb(17, 17, 51);">è·å–å¤–éƒ¨ã€æƒå¨ã€æœ€æ–°çš„ä¿¡æ¯</font>**<font style="color:rgb(17, 17, 51);">ä»¥æé«˜å›ç­”çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚</font>

<font style="color:rgb(17, 17, 51);">ç®€å•æ¥è¯´ï¼Œä½ å¯ä»¥æŠŠ AI è®°å¿†ç†è§£ä¸ºæ¨¡å‹â€œè®°å¾—â€å’Œä½ èŠè¿‡ä»€ä¹ˆï¼Œè€Œ RAG æ˜¯æ¨¡å‹åœ¨å›ç­”ä½ é—®é¢˜æ—¶ï¼Œä¼šâ€œæŸ¥èµ„æ–™â€æ¥ç¡®ä¿ç­”æ¡ˆæ­£ç¡®ã€‚ä¸€ä¸ªæ™ºèƒ½çš„ AI åŠ©æ‰‹å¾ˆå¯èƒ½ä¼šåŒæ—¶è¿ç”¨è¿™ä¸¤ç§èƒ½åŠ›ã€‚</font>

## åŒºåˆ«
| **<font style="color:rgb(17, 17, 51);">ç‰¹å¾</font>** | **<font style="color:rgb(17, 17, 51);">AI è®°å¿† (AI Memory)</font>** | **<font style="color:rgb(17, 17, 51);">RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ)</font>** |
| :--- | :--- | :--- |
| **<font style="color:rgb(17, 17, 51);">æ ¸å¿ƒæœºåˆ¶</font>** | <font style="color:rgb(17, 17, 51);">é€šè¿‡å­˜å‚¨å’Œæ£€ç´¢æ¨¡å‹è‡ªèº«çš„</font>**<font style="color:rgb(17, 17, 51);">äº¤äº’å†å²æˆ–å†…éƒ¨çŸ¥è¯†</font>**<font style="color:rgb(17, 17, 51);">æ¥å½±å“æœªæ¥çš„è¾“å‡ºã€‚è®°å¿†å¯ä»¥æ˜¯çŸ­æœŸçš„ï¼ˆå¦‚å¯¹è¯ä¸Šä¸‹æ–‡ï¼‰æˆ–é•¿æœŸçš„ï¼ˆå¦‚å‘é‡æ•°æ®åº“ä¸­å­˜å‚¨çš„è¿‡å¾€ç»éªŒï¼‰ã€‚</font> | <font style="color:rgb(17, 17, 51);">åœ¨ç”Ÿæˆå“åº”å‰ï¼Œä»</font>**<font style="color:rgb(17, 17, 51);">å¤–éƒ¨çŸ¥è¯†åº“</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆå¦‚æ–‡æ¡£ã€æ•°æ®åº“ã€ç½‘é¡µï¼‰ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œå¹¶å°†æ£€ç´¢åˆ°çš„å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡è¾“å…¥ç»™æ¨¡å‹ã€‚</font> |
| **<font style="color:rgb(17, 17, 51);">çŸ¥è¯†æ¥æº</font>** | <font style="color:rgb(17, 17, 51);">ä¸»è¦æ¥æºäºæ¨¡å‹ä¸ç”¨æˆ·çš„</font>**<font style="color:rgb(17, 17, 51);">äº¤äº’å†å²</font>**<font style="color:rgb(17, 17, 51);">æˆ–ç³»ç»Ÿé¢„è®¾çš„é•¿æœŸè®°å¿†ã€‚</font> | <font style="color:rgb(17, 17, 51);">æ¥æºäº</font>**<font style="color:rgb(17, 17, 51);">å¤–éƒ¨ã€ç‹¬ç«‹çš„ã€é€šå¸¸æ˜¯ç»“æ„åŒ–çš„çŸ¥è¯†åº“</font>**<font style="color:rgb(17, 17, 51);">ã€‚</font> |
| **<font style="color:rgb(17, 17, 51);">ä¸»è¦ç›®çš„</font>** | 1. **<font style="color:rgb(17, 17, 51);">ä¿æŒä¸Šä¸‹æ–‡ä¸€è‡´æ€§</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆå¦‚å¤šè½®å¯¹è¯ï¼‰ã€‚</font><br/>2. **<font style="color:rgb(17, 17, 51);">ä¸ªæ€§åŒ–</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆè®°ä½ç”¨æˆ·åå¥½ï¼‰ã€‚</font><br/>3. <font style="color:rgb(17, 17, 51);"></font>**<font style="color:rgb(17, 17, 51);">å­¦ä¹ å’Œé€‚åº”</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆä»è¿‡å¾€ç»éªŒä¸­å­¦ä¹ ï¼‰ã€‚</font> | 1. **<font style="color:rgb(17, 17, 51);">æä¾›æœ€æ–°ã€å‡†ç¡®çš„äº‹å®ä¿¡æ¯</font>**<font style="color:rgb(17, 17, 51);">.</font><br/>2. <font style="color:rgb(17, 17, 51);"> </font>**<font style="color:rgb(17, 17, 51);">å‡å°‘å¹»è§‰</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆåŸºäºæ£€ç´¢åˆ°çš„çœŸå®ä¿¡æ¯ç”Ÿæˆï¼‰.</font><br/>3. **<font style="color:rgb(17, 17, 51);">æ‰©å±•æ¨¡å‹çŸ¥è¯†è¾¹ç•Œ</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆè®¿é—®è®­ç»ƒæ•°æ®ä¹‹å¤–çš„ä¿¡æ¯ï¼‰ã€‚</font> |
| **<font style="color:rgb(17, 17, 51);">çŸ¥è¯†æ›´æ–°</font>** | <font style="color:rgb(17, 17, 51);">è®°å¿†å¯ä»¥åŠ¨æ€æ›´æ–°ï¼Œä½†éœ€è¦ç®¡ç†è®°å¿†çš„</font>**<font style="color:rgb(17, 17, 51);">å­˜å‚¨ã€æ£€ç´¢å’Œé—å¿˜</font>**<font style="color:rgb(17, 17, 51);">ã€‚æ›´æ–°å¯èƒ½å½±å“æ¨¡å‹è¡Œä¸ºã€‚</font> | <font style="color:rgb(17, 17, 51);">çŸ¥è¯†åº“å¯ä»¥ç‹¬ç«‹æ›´æ–°ï¼Œæ¨¡å‹æœ¬èº«æ— éœ€é‡æ–°è®­ç»ƒã€‚æ›´æ–°</font>**<font style="color:rgb(17, 17, 51);">è§£è€¦</font>**<font style="color:rgb(17, 17, 51);">äºæ¨¡å‹ã€‚</font> |
| **<font style="color:rgb(17, 17, 51);">å®ç°æ–¹å¼</font>** | + **<font style="color:rgb(17, 17, 51);">çŸ­æœŸè®°å¿†</font>**<font style="color:rgb(17, 17, 51);">ï¼šç›´æ¥åˆ©ç”¨æ¨¡å‹çš„ä¸Šä¸‹æ–‡çª—å£ï¼ˆContext Windowï¼‰ã€‚</font><br/>+ **<font style="color:rgb(17, 17, 51);">é•¿æœŸè®°å¿†</font>**<font style="color:rgb(17, 17, 51);">ï¼šä½¿ç”¨å‘é‡æ•°æ®åº“å­˜å‚¨å’Œæ£€ç´¢å…³é”®ä¿¡æ¯ç‰‡æ®µã€‚</font> | + **<font style="color:rgb(17, 17, 51);">æ£€ç´¢å™¨</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆå¦‚åŸºäºå‘é‡çš„ç›¸ä¼¼åº¦æœç´¢ï¼‰ã€‚</font><br/>+ **<font style="color:rgb(17, 17, 51);">ç”Ÿæˆå™¨</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰ã€‚</font><br/>+ **<font style="color:rgb(17, 17, 51);">çŸ¥è¯†åº“</font>**<font style="color:rgb(17, 17, 51);">ï¼ˆæ–‡æ¡£é›†åˆï¼‰ã€‚</font> |
| **<font style="color:rgb(17, 17, 51);">å…¸å‹åº”ç”¨</font>** | <font style="color:rgb(17, 17, 51);">èŠå¤©æœºå™¨äººä¿æŒå¯¹è¯è¿è´¯æ€§ã€ä¸ªæ€§åŒ–åŠ©æ‰‹ã€éœ€è¦é•¿æœŸå­¦ä¹ çš„AIä»£ç†ã€‚</font> | <font style="color:rgb(17, 17, 51);">é—®ç­”ç³»ç»Ÿã€å®¢æœçŸ¥è¯†åº“ã€äº‹å®æ ¸æŸ¥ã€æŠ¥å‘Šç”Ÿæˆï¼ˆéœ€è¦å¼•ç”¨å¤–éƒ¨èµ„æ–™ï¼‰ã€‚</font> |


# Memoryå®ç°
## Mem0
![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/121056529/1758008181340-7a31ba73-2ef0-43b0-9546-7726281b4aa4.png)

### <font style="color:rgb(65, 65, 69);">ç»„ä»¶</font>
+ <font style="color:rgb(65, 65, 69);">L</font>LMï¼ˆOpenAIã€Ollamaã€Azure OpenAIã€Geminiã€DeepSeekç­‰18ç§ï¼‰
+ <font style="color:rgb(65, 65, 69);">å‘é‡æ•°</font>æ®åº“ï¼ˆQdrantã€Chromaã€Pgvectorã€Milvusç­‰19ç§ï¼‰
+ <font style="color:rgb(65, 65, 69);">å›¾æ•°æ®åº“ï¼ˆ</font>Neo4jã€Memgraphã€Neptune Analyticsã€Kuzuï¼‰
+ <font style="color:rgb(65, 65, 69);">Embedding åµŒå…¥æ¨¡å‹ï¼ˆ</font>OpenAIã€Azure OpenAIã€Ollamaç­‰10ç§ï¼‰

### <font style="color:rgb(65, 65, 69);">æ¶æ„</font>
+ <font style="color:rgb(65, 65, 69);">API æ¥å£å±‚</font>
+ <font style="color:rgb(65, 65, 69);">æ™ºèƒ½å¤„ç†å±‚ï¼šLLMæ¨ç† + äº‹å®æå– + å†²çªè§£å†³</font>
    - äº‹å®æå–ï¼šä½¿ç”¨è‡ªå®šä¹‰æç¤ºè¯ä»å¯¹è¯ä¸­æå–å…³é”®ä¿¡æ¯
    - å†²çªè§£å†³ï¼šæ™ºèƒ½åˆ¤æ–­ADD/UPDATE/DELETE/NONEæ“ä½œ
    - è®°å¿†ä¼˜åŒ–ï¼šé¿å…å†—ä½™ï¼Œä¿æŒä¿¡æ¯æœ€æ–°
+ <font style="color:rgb(65, 65, 69);">åŒå­˜å‚¨æ¶æ„ï¼šå‘é‡æ•°æ®åº“+å›¾æ•°æ®åº“</font>
+ <font style="color:rgb(65, 65, 69);">å·¥å‚å±‚ï¼šLLM/Embedder/VectorStroe  Factory</font>

### <font style="color:rgb(65, 65, 69);">æµç¨‹</font>
**ä¸»æµç¨‹**

![](https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/c7e974749183b4f7f08d49a828b4a811.svg)

**<font style="color:rgb(65, 65, 69);">å¬å›æµç¨‹</font>**

![](https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/24193f5daddd60d9872b360f73b5fa8d.svg)

### æºç è§£æ
```python
# mem0çš„å¹¶å‘åŒè·¯å¬å›å®ç°
with concurrent.futures.ThreadPoolExecutor() as executor:
    # è·¯å¾„1ï¼šå‘é‡æ•°æ®åº“è¯­ä¹‰æœç´¢
    future_memories = executor.submit(self._search_vector_store, ...)

    # è·¯å¾„2ï¼šå›¾æ•°æ®åº“å…³ç³»æœç´¢  
    future_graph_entities = executor.submit(self.graph.search, ...)

    # è·å–ç»“æœ
    vector_memories = future_memories.result()     # å¬å›ç»“æœ
    graph_relations = future_graph_entities.result()  # å›¾è·¯å¾„å®ä½“å…³ç³»ç»“æœ 

# åˆ†åˆ«è¿”å›
return {
    "results": vector_memories,    # å‘é‡è·¯å¾„ç»“æœ
    "relations": graph_relations   # å›¾è·¯å¾„å®ä½“å…³ç³»ç»“æœ 
}
```



```python
def search(
    self,
    query: str,
    vectors: list[float],
    limit: Optional[int] = 5,
    filters: Optional[dict] = None,
) -> List[OutputData]:
    
    ...
    
    # è¿‡æ»¤æ¡ä»¶
    if filters:
        for k, v in filters.items():
            filter_conditions.append("payload->>%s = %s")
            filter_params.extend([k, str(v)])
    filter_clause = "WHERE " + " AND ".join(filter_conditions) if filter_conditions else ""

    # æ‰§è¡ŒSQLï¼šæ ‡é‡+å‘é‡
    with self._get_cursor() as cur:
        cur.execute(
            f"""
            SELECT id, vector <=> %s::vector AS distance, payload
            FROM {self.collection_name}
            {filter_clause}
            ORDER BY distance
            LIMIT %s
            """,
            (vectors, *filter_params, limit),
        )

        results = cur.fetchall()
    ...
```

```python
def search(self, query, filters, limit=100):
    ...

    # æ­¥éª¤1ï¼šllmæå–å®ä½“
    entity_type_map = self._retrieve_nodes_from_data(query, filters)
    # æ­¥éª¤2ï¼šå›¾æœç›¸å…³å®ä½“åŠå…³ç³»
    search_output = self._search_graph_db(node_list=list(entity_type_map.keys()), filters=filters)

    ...
    
    # æ­¥éª¤3ï¼šbm25å¯¹æœç´¢ç»“æœé‡æ’
    bm25 = BM25Okapi(search_outputs_sequence)

    tokenized_query = query.split(" ")
    reranked_results = bm25.get_top_n(tokenized_query, search_outputs_sequence, n=5)

    ...

# _search_graph_dbå›¾æœçš„å®ç°
def _search_graph_db(self, node_list, filters, limit=100):
    
    # è¿‡æ»¤æ¡ä»¶
    ...
    node_props_str = ...
    
    for node in node_list:
        n_embedding = self.embedding_model.embed(node)
    
        # åŸºäºå‘é‡ç›¸ä¼¼åº¦çš„èŠ‚ç‚¹æ£€ç´¢
        cypher_query = f"""
        -------åŒ¹é…å€™é€‰èŠ‚ç‚¹-------
        ---self.node_label = ":`__Entity__`" if self.config.graph_store.config.base_label else ""
        MATCH (n {self.node_label} {{{node_props_str}}})
        WHERE n.embedding IS NOT NULL
        -------è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦-------
        WITH n, round(2 * vector.similarity.cosine(n.embedding, $n_embedding) - 1, 4) AS similarity // denormalize for backward compatibility
        WHERE similarity >= $threshold
        -------æ‰¾åˆ°å‡ºè¾¹ã€å…¥è¾¹-------
        CALL 
            WITH n
            MATCH (n)-[r]->(m {self.node_label} {{{node_props_str}}})
            RETURN n.name AS source, elementId(n) AS source_id, type(r) AS relationship, elementId(r) AS relation_id, m.name AS destination, elementId(m) AS destination_id
            UNION
            WITH n  
            MATCH (n)<-[r]-(m {self.node_label} {{{node_props_str}}})
            RETURN m.name AS source, elementId(m) AS source_id, type(r) AS relationship, elementId(r) AS relation_id, n.name AS destination, elementId(n) AS destination_id
        
        WITH distinct source, source_id, relationship, relation_id, destination, destination_id, similarity
        RETURN source, source_id, relationship, relation_id, destination, destination_id, similarity
        ORDER BY similarity DESC
        LIMIT $limit
        """
    
        params = {
            "n_embedding": n_embedding,
            "threshold": self.threshold,
            "user_id": filters["user_id"],
            "limit": limit,
        }
        
        ...
        
        ans = self.graph.query(cypher_query, params=params)
        result_relations.extend(ans)
    
    return result_relations
```

## <font style="color:rgb(62, 62, 62);">ğŸŒŸPowerMemğŸŒŸ</font>
GitHub: [https://github.com/oceanbase/PowerMem](https://github.com/oceanbase/PowerMem)
### æ€§èƒ½æå‡
#### å¤šè·¯å¬å›/æ··æœ
**æµç¨‹å›¾**

+ å…¨æ–‡+å‘é‡+æ ‡é‡
    - 441åŠä»¥ä¸Šå¯ä»¥ç›´æ¥ä½¿ç”¨å†…æ ¸çš„æ··æœ
+ èåˆç²—æ’ï¼ˆRRFï¼‰+ç²¾æ’ï¼ˆRerankæ¨¡å‹ï¼‰
    - rerankå¯å°†å‡†ç¡®ç‡æå‡ï½6%

![](https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/0419ae711535f7dd9b2920933a467a26.svg)

**æºç è§£æï¼š**

```python
def _hybrid_search(self, query: str, vectors: List[List[float]], limit: int = 5, filters: Optional[Dict] = None,
                   fusion_method: str = "rrf", k: int = 60):

    # å•è·¯limitæ‰©æˆ3å€
    candidate_limit = limit * 3 if self.reranker else limit

    # æ­¥éª¤ 1: åˆ†åˆ«æŸ¥è¯¢
    with ThreadPoolExecutor(max_workers=2) as executor:
        # å‘é‡
        vector_future = executor.submit(self._vector_search, query, vectors, candidate_limit, filters)
        # å…¨æ–‡
        fts_future = executor.submit(self._fulltext_search, query, candidate_limit, filters)

        vector_results = vector_future.result()
        fts_results = fts_future.result()

    # æ­¥éª¤ 2: ç»“æœèåˆè¿›è¡Œç²—æ’,ç»“æœé™åˆ¶ä¸º3 * limit
    coarse_ranked_results = self._combine_search_results(
        vector_results, fts_results, candidate_limit, fusion_method, k
    )

    
    # æ­¥éª¤ 3ï¼šè¿›è¡Œç²¾æ’ï¼ˆä½¿ç”¨qwen3-rerankæ¨¡å‹ï¼‰,ç»“æœé™åˆ¶ä¸ºlimit
    if self.reranker and query and coarse_ranked_results:
        final_results = self._apply_rerank(query, coarse_ranked_results, limit)
        return final_results
    else:
        return coarse_ranked_results[:limit]

# rerank
def _apply_rerank(self, query: str, candidates: List[OutputData], limit: int) -> List[OutputData]:
    
    ...

    # Call reranker to get reranked indices and scores
    reranked_indices = self.reranker.rerank(query, documents, top_n=limit)
    
    ...
    
    # ç‰¹æ®Šå¤„ç†ï¼šåˆ†æ•°é«˜çš„åœ¨å¤´å’Œå°¾ï¼Œå› ä¸ºLLMå…·æœ‰æ•ˆåº”è¿‘å› æ•ˆåº”
    if len(final_results) > 1:
        reordered = [None] * len(final_results)
        left = 0
        right = len(final_results) - 1
        
        for i, result in enumerate(final_results):
            if i % 2 == 0:
                # Even indices go to the left side
                reordered[left] = result
                left += 1
            else:
                # Odd indices go to the right side
                reordered[right] = result
                right -= 1
        
        final_results = reordered

    return final_results
```



**<font style="color:rgb(13, 18, 57);">è¿‘å› æ•ˆåº”</font>**æ•ˆåº”æ¥æºï¼š

> + **<font style="color:rgb(13, 18, 57);">è®ºæ–‡æ ‡é¢˜</font>**<font style="color:rgb(13, 18, 57);">: </font>**<font style="color:rgb(13, 18, 57);">Lost in the Middle: How Language Models Use Long Contexts</font>**
> + **<font style="color:rgb(13, 18, 57);">ä½œè€…</font>**<font style="color:rgb(13, 18, 57);">: Nelson F. Liu, Kevin Lin, John Hewitt, Ashwin Paranjape, Michele Catasta, Percy Liang</font>
> + **<font style="color:rgb(13, 18, 57);">å‘å¸ƒ</font>**<font style="color:rgb(13, 18, 57);">: 2023å¹´</font>
> + **<font style="color:rgb(13, 18, 57);">é“¾æ¥</font>**<font style="color:rgb(13, 18, 57);">: </font>[<font style="color:rgb(94, 92, 230);">https://arxiv.org/abs/2307.03172</font>](https://arxiv.org/abs/2307.03172)
>

![](https://intranetproxy.alipay.com/skylark/lark/0/2025/png/121056529/1763013612851-0744c233-95ee-42c7-981c-3da69854f525.png)

**<font style="color:rgb(13, 18, 57);">Uå‹æ€§èƒ½æ›²çº¿ï¼ˆU-shaped Performance Curveï¼‰</font>**<font style="color:rgb(13, 18, 57);">: è®ºæ–‡çš„æ ¸å¿ƒå‘ç°æ˜¯ï¼Œå½“æ¨¡å‹éœ€è¦ä»é•¿ç¯‡è¾“å…¥æ–‡æœ¬ï¼ˆé•¿ä¸Šä¸‹æ–‡ï¼‰ä¸­æ£€ç´¢ä¿¡æ¯æ—¶ï¼Œå…¶æ€§èƒ½å‘ˆç°å‡ºæ˜æ˜¾çš„â€œUå‹â€æ›²çº¿ã€‚</font>

    - <font style="color:rgb(13, 18, 57);">ä½äºè¾“å…¥åºåˆ—</font>**<font style="color:rgb(13, 18, 57);">å¼€å¤´ï¼ˆPrimacyï¼‰å’Œç»“å°¾ï¼ˆRecencyï¼‰</font>**<font style="color:rgb(13, 18, 57);">çš„ä¿¡æ¯ï¼Œèƒ½è¢«æ¨¡å‹æœ€å‡†ç¡®åœ°å›å¿†å’Œä½¿ç”¨ã€‚</font>
    - <font style="color:rgb(13, 18, 57);">ä½äºè¾“å…¥åºåˆ—</font>**<font style="color:rgb(13, 18, 57);">ä¸­é—´</font>**<font style="color:rgb(13, 18, 57);">çš„ä¿¡æ¯ï¼Œè¢«å›å¿†å’Œä½¿ç”¨çš„å‡†ç¡®ç‡æ˜¾è‘—ä¸‹é™ï¼Œä»¿ä½›â€œåœ¨ä¸­é—´è¿·å¤±äº†â€ã€‚</font>

**è®ºæ–‡ç»“è®º**

+ **<font style="color:rgb(13, 18, 57);">System Prompt ä¸ºä»€ä¹ˆå¿…é¡»åœ¨å‰ï¼Ÿ</font>**<font style="color:rgb(13, 18, 57);"> </font><font style="color:rgb(13, 18, 57);">å› ä¸ºå®ƒéœ€è¦åˆ©ç”¨</font><font style="color:rgb(13, 18, 57);"> </font>**<font style="color:rgb(13, 18, 57);">Primacy Effect (é¦–å› æ•ˆåº”)</font>**<font style="color:rgb(13, 18, 57);">ã€‚ç³»ç»ŸæŒ‡ä»¤ã€è§’è‰²å®šä¹‰ã€æ ¸å¿ƒè§„åˆ™æ˜¯å…¨å±€æ€§çš„ï¼Œå¿…é¡»è¢«æ¨¡å‹ç‰¢ç‰¢è®°ä½ï¼Œä½œä¸ºæ•´ä¸ªå¯¹è¯çš„åŸºçŸ³ã€‚æ”¾åœ¨å¼€å¤´ï¼Œèƒ½ç¡®ä¿å®ƒä»¬è·å¾—æœ€é«˜çš„æ³¨æ„åŠ›æƒé‡ã€‚</font>
+ **<font style="color:rgb(13, 18, 57);">ç”¨æˆ·å½“å‰è¾“å…¥ (User Input) ä¸ºä»€ä¹ˆå¿…é¡»åœ¨åï¼Ÿ</font>**<font style="color:rgb(13, 18, 57);"> å› ä¸ºå®ƒéœ€è¦åˆ©ç”¨ </font>**<font style="color:rgb(13, 18, 57);">Recency Effect (è¿‘å› æ•ˆåº”)</font>**<font style="color:rgb(13, 18, 57);">ã€‚ç”¨æˆ·çš„å…·ä½“é—®é¢˜æ˜¯æ¨¡å‹éœ€è¦ç«‹å³å“åº”çš„æŒ‡ä»¤ã€‚æ”¾åœ¨ç»“å°¾ï¼Œèƒ½ç¡®ä¿å®ƒæˆä¸ºæ¨¡å‹æ³¨æ„åŠ›çš„ç„¦ç‚¹ï¼Œä»è€Œç›´æ¥é©±åŠ¨ç”Ÿæˆè¿‡ç¨‹ã€‚</font>

#### æ•°æ®åˆ†å±‚
**ç›®çš„ï¼š**

é’ˆå¯¹ä¸åŒæ•°æ®é‡‡ç”¨ä¸åŒçš„å‘é‡ç»´åº¦ï¼Œå’Œä¸åŒçš„ç´¢å¼•ç±»å‹ï¼Œå¯¹åº•å±‚æ•°æ®è¿›è¡Œåˆ†å±‚ï¼Œé€šè¿‡**å­è¡¨å­˜å‚¨+æ™ºèƒ½è·¯ç”±**æ¥è¾¾åˆ°æœ€åˆç†ã€é«˜æ•ˆçš„åˆ©ç”¨ã€‚ä¾‹å¦‚ä¸»è¡¨1536ç»´ï¼Œå·¥ä½œè®°å¿†è¡¨512ç»´ï¼Œå½’æ¡£è¡¨256ç»´



**æ ¸å¿ƒå®ç°é€»è¾‘ï¼š**

åˆ©ç”¨æ•°æ®åº“è¡¨å­—æ®µä¸­metadataï¼ˆjsonï¼‰ï¼Œæ ¹æ®ä¸åŒçš„filteræ¥è¿›è¡Œè·¯ç”±åˆ†å‘



**å‰ç½®æ¡ä»¶ï¼š**

å­è¡¨çš„æ•°æ®ä¸ä¸»è¡¨çš„æ•°æ®**æ²¡æœ‰äº¤é›†ï¼Œ**ä¾‹å¦‚å­è¡¨ä¸ºå…±æœ‰è®°å¿†ï¼Œä¸»è¡¨ä¸ºç§æœ‰è®°å¿†ï¼Œå•è¯æŸ¥è¯¢type=XXæ—¶åªä¼šå»æŸ¥è¯¢ä¸€å¼ è¡¨



**è·¯ç”±æµç¨‹å›¾**

![](https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/e14e73aaed11c6f4f856f93529ea1677.svg)

#### OB Graphå®ç°
å›¾æ•°æ®åº“ä¸€èˆ¬æ˜¯ä¸ºäº†è§£å†³<font style="color:rgb(13, 18, 57);">æŸ¥è¯¢å…·æœ‰</font>**<font style="color:rgb(13, 18, 57);">å¤æ‚å…³ç³»çš„å¤§é‡æ•°æ®</font>**ï¼Œä¾‹å¦‚åƒåŒºå—é“¾å’Œå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼Œä½†åœ¨RAGã€è®°å¿†æ£€ç´¢çš„ç¯å¢ƒä¸‹ï¼Œå¤šè·³çš„éœ€æ±‚å¾€å¾€æ˜¯æœ‰é™çš„ï¼Œå¹¶ä¸”å®ä½“ä¸å®ä½“ä¹‹é—´çš„å…³ç³»æ•°æ®é‡æ˜¯å¯é¢„æµ‹ï¼Œå› æ­¤ç”¨å…³ç³»æ•°æ®åº“ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒç›®çš„



**è¡¨ç»“æ„**

```plain
graph_entitiesã€å®ä½“ã€‘
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ name (å®ä½“åç§°)
â”œâ”€â”€ entity_type (å®ä½“ç±»å‹)
â”œâ”€â”€ embedding (å‘é‡åµŒå…¥)
â”œâ”€â”€ created_at (åˆ›å»ºæ—¶é—´)
â””â”€â”€ updated_at (æ›´æ–°æ—¶é—´)


graph_relationshipsã€å…³ç³»ã€‘
â”œâ”€â”€ id (ä¸»é”®)
â”œâ”€â”€ source_entity_id (æºå®ä½“ ID)
â”œâ”€â”€ destination_entity_id (ç›®æ ‡å®ä½“ ID)
â”œâ”€â”€ relationship_type (å…³ç³»ç±»å‹)
â”œâ”€â”€ user_id (ç”¨æˆ· ID)
â”œâ”€â”€ agent_id (Agent ID)
â”œâ”€â”€ run_id (Run ID)
â”œâ”€â”€ created_at (åˆ›å»ºæ—¶é—´)
â””â”€â”€ updated_at (æ›´æ–°æ—¶é—´)
```

**å¤šè·³æœç´¢ **

```plsql
-- ç¬¬1è·³
SELECT
    ...
FROM
    (
    SELECT
        ...
    FROM {self.å…³ç³»è¡¨}
    WHERE
        source_entity_id IN ('alice_uuid', 'bob_uuid')  -- ç§å­å®ä½“
        AND r.user_id = 'user123'
    ORDER BY mentions DESC, created_at DESC
    LIMIT 1000
) AS r
JOIN {self.å®ä½“è¡¨} e1 ON r.source_entity_id = e1.id
JOIN {self.å®ä½“è¡¨} e2 ON r.destination_entity_id = e2.id;

-- ç¬¬2è·³
-- ç»“æ„å®Œå…¨ç›¸åŒï¼Œåªæ˜¯å‚æ•°ä¸åŒ
SELECT
    ...
FROM
    (
    SELECT
        ...
    FROM {self.å…³ç³»è¡¨}
    WHERE
        source_entity_id IN ('openai_uuid', 'sf_uuid', 'charlie_uuid', ...)  -- ç¬¬1è·³çš„destination_id
        AND r.user_id = 'user123'
    ORDER BY mentions DESC, created_at DESC
    LIMIT 1000
) AS r
JOIN {self.å®ä½“è¡¨} e1 ON r.source_entity_id = e1.id
JOIN {self.å®ä½“è¡¨} e2 ON r.destination_entity_id = e2.id;

-- ç¬¬3è·³
-- ç»“æ„å®Œå…¨ç›¸åŒï¼Œåªæ˜¯å‚æ•°ä¸åŒ
....
```

![](https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/3597d193def6ef4e703bb0805a9c2f25.svg)

**ä¸¾ä¾‹è¯´æ˜**

```plain
åˆå§‹: current_sources = ['alice_uuid', 'bob_uuid']

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬1è·³: SQL-1                       	â”‚
â”‚  IN ('alice_uuid', 'bob_uuid')      â”‚
â”‚  è¿”å›: 30ä¸ªå…³ç³»                      	â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ åº”ç”¨å±‚é˜²ç¯è¿‡æ»¤
           â”œâ”€ ç´¯è®¡ç»“æœ: 30ä¸ª
           â”œâ”€ æ£€æŸ¥: 30 < 100, ç»§ç»­
           â”‚
           â””â”€ æå–destination_idä½œä¸ºä¸‹ä¸€è·³èµ·ç‚¹
              current_sources = ['openai_uuid', 'sf_uuid', ...]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬2è·³: SQL-2                       	â”‚
â”‚  IN ('openai_uuid', 'sf_uuid', ...) â”‚
â”‚  è¿”å›: 45ä¸ªå…³ç³»                      	â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ åº”ç”¨å±‚é˜²ç¯è¿‡æ»¤ (è¿‡æ»¤æ‰5ä¸ªé‡å¤è¾¹)
           â”œâ”€ ç´¯è®¡ç»“æœ: 30 + 40 = 70ä¸ª
           â”œâ”€ æ£€æŸ¥: 70 < 100, ç»§ç»­
           â”‚
           â””â”€ æå–destination_idä½œä¸ºä¸‹ä¸€è·³èµ·ç‚¹
              current_sources = ['sam_uuid', 'ca_uuid', ...]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬3è·³: SQL-3                       	â”‚
â”‚  IN ('sam_uuid', 'ca_uuid', ...)    â”‚
â”‚  è¿”å›: 40ä¸ªå…³ç³»                      	â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ åº”ç”¨å±‚é˜²ç¯è¿‡æ»¤ (è¿‡æ»¤æ‰5ä¸ªé‡å¤è¾¹)
           â”œâ”€ ç´¯è®¡ç»“æœ: 70 + 35 = 105ä¸ª
           â”œâ”€ æ£€æŸ¥: 105 >= 100 âœ… æ»¡è¶³limit!
           â”‚
           â””â”€ è¿”å› all_results[:100]
```

### ç‰¹æ€§
#### <font style="color:rgb(62, 62, 62);">æ™ºèƒ½è®°å¿†ç®¡ç†</font>
é€šè¿‡æ—¶é—´è¡°å‡ã€é‡è¦æ€§è¯„ä¼°å’Œé—´éš”å¤ä¹ æœºåˆ¶ï¼Œåƒäººç±»è®°å¿†ä¸€æ ·ï¼Œå®ç°è‡ªé€‚åº”é—å¿˜æœºåˆ¶ä»¥é˜²æ­¢ä¿¡æ¯è¿‡è½½ã€‚

<font style="color:rgb(62, 62, 62);"></font>

<font style="color:rgb(62, 62, 62);">ç®—æ³•åŸºç¡€ï¼š</font>

![image](https://intranetproxy.alipay.com/skylark/lark/__latex/da72504d1dbc9ecc988ebfa0d1a7b4eb.svg)

å…¶ä¸­ï¼š

+ R: è®°å¿†ä¿ç•™ç‡ (Retention Rate)ï¼ŒèŒƒå›´ [0, 1]
+ t: æ—¶é—´é—´éš” (Time elapsed)ï¼Œå•ä½ï¼šå°æ—¶
+ S: è®°å¿†å¼ºåº¦ (Strength)ï¼Œç”±è¡°å‡ç‡(decay_rate)å†³å®š<font style="color:rgb(62, 62, 62);"></font>

**è®°å¿†æ·»åŠ æµç¨‹**

![](https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/46230a4bf8a3f429e2333c60086496b6.svg)



**è®°å¿†è®¿é—®æµç¨‹**

![](https://intranetproxy.alipay.com/skylark/lark/__mermaid_v3/e1bd1899233317918c812351cb3ede8e.svg)



è®°å¿†å…ƒæ•°æ®ç»“æ„

```json
{
    "intelligence": {
        "importance_score": 0.85,           # é‡è¦æ€§åˆ†æ•°
        "memory_type": "long_term",         # è®°å¿†ç±»å‹
        "initial_retention": 0.85,          # åˆå§‹ä¿ç•™ç‡
        "decay_rate": 0.1,                  # è¡°å‡ç‡
        "current_retention": 0.72,          # å½“å‰ä¿ç•™ç‡
        "next_review": "2024-01-02T10:00:00",  # ä¸‹æ¬¡å¤ä¹ æ—¶é—´ï¼Œå¤ä¹ ä¼š"é‡ç½®"é—å¿˜æ›²çº¿ï¼Œä»å¤ä¹ æ—¶é—´ç‚¹é‡æ–°å¼€å§‹è¡°å‡
        "review_schedule": [...],           # å¤ä¹ è®¡åˆ’
        "last_reviewed": "2024-01-01T10:00:00",  # æœ€åå¤ä¹ æ—¶é—´
        "review_count": 2,                  # å¤ä¹ æ¬¡æ•°
        "access_count": 5,                  # è®¿é—®æ¬¡æ•°
        "reinforcement_factor": 0.3         # å¼ºåŒ–å› å­ï¼Œå¯¹ä¿ç•™ç‡è¿›è¡Œè°ƒæ•´
    },
    "memory_management": {
        "should_promote": False,            # æ˜¯å¦åº”è¯¥æå‡
        "should_forget": False,             # æ˜¯å¦åº”è¯¥é—å¿˜
        "should_archive": False,            # æ˜¯å¦åº”è¯¥å½’æ¡£
        "is_active": True                   # æ˜¯å¦æ´»è·ƒ
    },
    "created_at": "2024-01-01T10:00:00",   # åˆ›å»ºæ—¶é—´
    "updated_at": "2024-01-01T15:00:00"    # æ›´æ–°æ—¶é—´
}
```

# <font style="color:rgb(62, 62, 62);">å‚è€ƒ</font>
1. [ã€ŠThe Rise and Potential of Large Language Model Based Agents: A Surveyã€‹](https://arxiv.org/abs/2309.07864)
2. [ã€ŠLost in the Middle: How Language Models Use Long Contextsã€‹](https://arxiv.org/abs/2307.03172)

